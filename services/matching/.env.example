# ============================================
# MATCHING SERVICE ENVIRONMENT CONFIGURATION
# ============================================
# Copy this file to .env and fill in values
# NEVER commit .env to version control
# ============================================

# --------------------------------------
# APP METADATA
# --------------------------------------
# Service identifier for logging and tracing
SERVICE_NAME=matching-service
# Deployment environment
NODE_ENV=development
# Service port
PORT=3003
# Log level (trace, debug, info, warn, error, fatal)
LOG_LEVEL=info

# --------------------------------------
# EVENT BUS (HTTP-based)
# --------------------------------------
# Event Bus service URL
EVENT_BUS_URL=http://localhost:3010
# API key for authenticating with event bus
EVENT_BUS_API_KEY=your-event-bus-api-key

# --------------------------------------
# DATABASE (PostgreSQL via Supabase)
# --------------------------------------
# Database connection string (read replica preferred for matching queries)
DATABASE_URL=postgresql://postgres:postgres@localhost:54322/postgres
# Connection pool size
DATABASE_POOL_MIN=2
DATABASE_POOL_MAX=10

# --------------------------------------
# AUTHENTICATION (Service-to-Service)
# --------------------------------------
# Supabase service role key for internal API calls
# SECURITY: This key has elevated privileges - never expose to frontend
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key-here
# JWT secret for verifying internal service tokens
INTERNAL_JWT_SECRET=your-internal-jwt-secret-min-32-chars

# --------------------------------------
# MATCHING CONFIGURATION
# --------------------------------------
# Number of agents to match per request (min)
MATCHING_MIN_AGENTS=2
# Number of agents to match per request (max)
MATCHING_MAX_AGENTS=3
# Timeout for agent response in hours
AGENT_RESPONSE_TIMEOUT_HOURS=24
# Star agent minimum rating threshold (0-5)
STAR_AGENT_MIN_RATING=4.5
# Minimum completed bookings for star status
STAR_AGENT_MIN_BOOKINGS=10

# --------------------------------------
# PEAK SEASON HANDLING
# --------------------------------------
# Enable peak season scarcity mode
PEAK_SEASON_MODE_ENABLED=false
# Reduce matching requirements during peak (allow 1 agent minimum)
PEAK_SEASON_ALLOW_SINGLE_AGENT=false
# Extended timeout during peak season (hours)
PEAK_SEASON_TIMEOUT_HOURS=48

# --------------------------------------
# FEATURE TOGGLES
# --------------------------------------
# Enable bench agent fallback when star agents unavailable
ENABLE_BENCH_FALLBACK=true
# Enable geographic preference matching
ENABLE_GEO_MATCHING=true
# Enable specialization matching (honeymoon, adventure, etc.)
ENABLE_SPECIALIZATION_MATCHING=true

# --------------------------------------
# OPERATIONAL LIMITS
# --------------------------------------
# Maximum matching attempts before failing request
MAX_MATCHING_ATTEMPTS=3
# Cooldown period between matching attempts (seconds)
MATCHING_RETRY_COOLDOWN_SECONDS=300
# Maximum concurrent matching operations
MAX_CONCURRENT_MATCHES=100

# --------------------------------------
# AUDIT & OBSERVABILITY
# --------------------------------------
# Enable detailed audit logging
AUDIT_LOG_ENABLED=true
# Audit log retention days
AUDIT_LOG_RETENTION_DAYS=90
# Enable metrics collection
METRICS_ENABLED=true
# Metrics endpoint port (0 to disable)
METRICS_PORT=9103
