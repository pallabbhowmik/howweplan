# ============================================================================
# MESSAGING SERVICE - ENVIRONMENT CONFIGURATION
# ============================================================================
# This service handles platform-only chat, contact masking, and message
# retention for disputes. All messages are auditable.
# ============================================================================

# ----------------------------------------------------------------------------
# APP METADATA
# ----------------------------------------------------------------------------
# Service identification and runtime environment
SERVICE_NAME=messaging-service
NODE_ENV=development
PORT=3006
LOG_LEVEL=info

# ----------------------------------------------------------------------------
# DATABASE
# ----------------------------------------------------------------------------
# PostgreSQL connection for message storage and retention
# Format: postgresql://user:password@host:port/database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/tripcomposer_messaging

# ----------------------------------------------------------------------------
# EVENT BUS
# ----------------------------------------------------------------------------
# Message broker for inter-service communication
# Supports: redis, rabbitmq, kafka
EVENT_BUS_TYPE=redis
EVENT_BUS_URL=redis://localhost:6379
EVENT_BUS_PREFIX=tripcomposer:messaging

# ----------------------------------------------------------------------------
# AUTHENTICATION
# ----------------------------------------------------------------------------
# Supabase configuration for identity verification
# Service role key required for server-side identity lookups
SUPABASE_URL=http://localhost:54321
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key-here

# JWT verification for incoming requests
JWT_SECRET=your-jwt-secret-for-development-only
JWT_ISSUER=tripcomposer

# ----------------------------------------------------------------------------
# INTERNAL SERVICE COMMUNICATION
# ----------------------------------------------------------------------------
# URLs for internal service calls (validated at startup)
BOOKING_SERVICE_URL=http://localhost:3004
IDENTITY_SERVICE_URL=http://localhost:3002

# Internal service API key for service-to-service auth
INTERNAL_API_KEY=internal-dev-api-key-change-in-production

# ----------------------------------------------------------------------------
# MESSAGE RETENTION & COMPLIANCE
# ----------------------------------------------------------------------------
# Retention period for messages (disputes require evidence)
# Format: number of days
MESSAGE_RETENTION_DAYS=730

# Evidence export encryption key (AES-256)
EVIDENCE_ENCRYPTION_KEY=32-character-encryption-key-here

# ----------------------------------------------------------------------------
# CONTACT MASKING
# ----------------------------------------------------------------------------
# Patterns to detect and mask in messages before payment
# Email regex pattern for masking
MASK_EMAIL_PATTERN=true

# Phone number detection and masking
MASK_PHONE_PATTERN=true

# URL/link detection and masking
MASK_URL_PATTERN=true

# Social media handle detection
MASK_SOCIAL_HANDLES=true

# ----------------------------------------------------------------------------
# RATE LIMITING
# ----------------------------------------------------------------------------
# Prevent spam and abuse
# Maximum messages per conversation per minute
RATE_LIMIT_MESSAGES_PER_MINUTE=30

# Maximum new conversations per user per hour
RATE_LIMIT_CONVERSATIONS_PER_HOUR=10

# Cooldown period after rate limit hit (seconds)
RATE_LIMIT_COOLDOWN_SECONDS=60

# ----------------------------------------------------------------------------
# OPERATIONAL LIMITS
# ----------------------------------------------------------------------------
# Maximum message length in characters
MAX_MESSAGE_LENGTH=5000

# Maximum attachments per message
MAX_ATTACHMENTS_PER_MESSAGE=5

# Maximum attachment size in bytes (5MB)
MAX_ATTACHMENT_SIZE_BYTES=5242880

# Allowed attachment MIME types (comma-separated)
ALLOWED_ATTACHMENT_TYPES=image/jpeg,image/png,image/webp,application/pdf

# ----------------------------------------------------------------------------
# STORAGE
# ----------------------------------------------------------------------------
# S3-compatible storage for message attachments
STORAGE_ENDPOINT=http://localhost:9000
STORAGE_BUCKET=messaging-attachments
STORAGE_ACCESS_KEY=minio-dev-access-key
STORAGE_SECRET_KEY=minio-dev-secret-key
STORAGE_REGION=us-east-1

# ----------------------------------------------------------------------------
# AUDIT & OBSERVABILITY
# ----------------------------------------------------------------------------
# All message operations emit audit events
AUDIT_LOG_ENABLED=true

# OpenTelemetry configuration
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4318
OTEL_SERVICE_NAME=messaging-service

# Structured logging output format: json, pretty
LOG_FORMAT=pretty

# ----------------------------------------------------------------------------
# FEATURE TOGGLES
# ----------------------------------------------------------------------------
# Enable real-time WebSocket connections
WEBSOCKET_ENABLED=true
WEBSOCKET_PORT=3016

# Enable typing indicators
TYPING_INDICATORS_ENABLED=true

# Enable read receipts
READ_RECEIPTS_ENABLED=true

# Enable message reactions
REACTIONS_ENABLED=false
